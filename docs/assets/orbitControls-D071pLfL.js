function w(){const c=new Float32Array([-1,-1,1,0,0,1,1,-1,1,0,0,1,1,1,1,0,0,1,-1,1,1,0,0,1,1,-1,-1,0,0,-1,-1,-1,-1,0,0,-1,-1,1,-1,0,0,-1,1,1,-1,0,0,-1,-1,1,1,0,1,0,1,1,1,0,1,0,1,1,-1,0,1,0,-1,1,-1,0,1,0,-1,-1,-1,0,-1,0,1,-1,-1,0,-1,0,1,-1,1,0,-1,0,-1,-1,1,0,-1,0,1,-1,1,1,0,0,1,-1,-1,1,0,0,1,1,-1,1,0,0,1,1,1,1,0,0,-1,-1,-1,-1,0,0,-1,-1,1,-1,0,0,-1,1,1,-1,0,0,-1,1,-1,-1,0,0]),t=new Uint16Array([0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23]);return{vertices:c,indices:t}}function A(c=1,t=16,s=12){const o=[],n=[];for(let e=0;e<=s;e++)for(let a=0;a<=t;a++){const h=a/t,u=e/s,p=h*Math.PI*2,r=u*Math.PI,d=-c*Math.sin(r)*Math.cos(p),M=c*Math.cos(r),f=c*Math.sin(r)*Math.sin(p),v=d/c,l=M/c,y=f/c;o.push(d,M,f,v,l,y)}const i=t+1;for(let e=0;e<s;e++)for(let a=0;a<t;a++){const h=e*i+a,u=e*i+a+1,p=(e+1)*i+a,r=(e+1)*i+a+1;e!==0&&n.push(h,r,u),e!==s-1&&n.push(h,p,r)}return{vertices:new Float32Array(o),indices:new Uint16Array(n)}}function P(c=16){const t=[],s=[];t.push(0,1,0,0,1,0);for(let i=0;i<c;i++){const e=i/c*Math.PI*2,a=Math.sin(e),h=Math.cos(e);t.push(a,1,h,0,1,0)}for(let i=0;i<c;i++)s.push(0,i+1,(i+1)%c+1);const o=t.length/6;t.push(0,-1,0,0,-1,0);for(let i=0;i<c;i++){const e=i/c*Math.PI*2,a=Math.sin(e),h=Math.cos(e);t.push(a,-1,h,0,-1,0)}for(let i=0;i<c;i++)s.push(o,o+(i+1)%c+1,o+i+1);const n=t.length/6;for(let i=0;i<=c;i++){const e=i/c*Math.PI*2,a=Math.sin(e),h=Math.cos(e);t.push(a,1,h,a,0,h),t.push(a,-1,h,a,0,h)}for(let i=0;i<c;i++){const e=n+i*2,a=n+i*2+1,h=n+(i+1)*2,u=n+(i+1)*2+1;s.push(e,a,u),s.push(e,u,h)}return{vertices:new Float32Array(t),indices:new Uint16Array(s)}}function g(c){return{I:[[-1.5,.5,.5],[-.5,.5,.5],[.5,.5,.5],[1.5,.5,.5]],J:[[-1.5,1.5,.5],[-1.5,.5,.5],[-.5,.5,.5],[.5,.5,.5]],L:[[1.5,1.5,.5],[1.5,.5,.5],[.5,.5,.5],[-.5,.5,.5]],O:[[-.5,1.5,.5],[.5,1.5,.5],[-.5,.5,.5],[.5,.5,.5]],S:[[.5,1.5,.5],[-.5,1.5,.5],[-.5,.5,.5],[-1.5,.5,.5]],T:[[-.5,1.5,.5],[-1.5,.5,.5],[-.5,.5,.5],[.5,.5,.5]],Z:[[-1.5,1.5,.5],[-.5,1.5,.5],[-.5,.5,.5],[.5,.5,.5]]}[c]}function _(c){const t=g(c);if(!t)throw new Error("Unknown tetris type");const s=w(),o=s.vertices.length/6,n=o*4,i=new Float32Array(n*6),e=s.indices.length,a=new Uint16Array(e*4);let h=0,u=0,p=0;for(let r of t)h+=r[0],u+=r[1],p+=r[2];h/=4,u/=4,p/=4;for(let r=0;r<4;r++){const d=t[r],M=(d[0]-h)*1,f=(d[1]-u)*1,v=(d[2]-p)*1;for(let l=0;l<o;l++){let y=s.vertices[l*6+0]*.5,x=s.vertices[l*6+1]*.5,z=s.vertices[l*6+2]*.5;i[(r*o+l)*6+0]=y+M,i[(r*o+l)*6+1]=x+f,i[(r*o+l)*6+2]=z+v,i[(r*o+l)*6+3]=s.vertices[l*6+3],i[(r*o+l)*6+4]=s.vertices[l*6+4],i[(r*o+l)*6+5]=s.vertices[l*6+5]}for(let l=0;l<e;l++)a[r*e+l]=s.indices[l]+r*o}return{vertices:i,indices:a}}class I{constructor(t,s={}){this.canvas=t,this.target=s.target||[0,.5,0],this.radius=s.radius||14,this.minRadius=s.minRadius||2,this.maxRadius=s.maxRadius||800,this.theta=s.theta||0,this.phi=s.phi||Math.PI/4,this.rotateSpeed=s.rotateSpeed||.005,this.zoomSpeed=s.zoomSpeed||.0015,this.panSpeed=s.panSpeed||.001,this._dragging=!1,this._dragButton=0,this._last=[0,0],this._initEvents()}_initEvents(){this.canvas.addEventListener("pointerdown",t=>{this._dragging=!0,this._dragButton=t.button,this._last=[t.clientX,t.clientY],this.canvas.setPointerCapture(t.pointerId),t.preventDefault()}),this.canvas.addEventListener("contextmenu",t=>{t.preventDefault()}),this.canvas.addEventListener("pointerup",t=>{this._dragging=!1,this.canvas.releasePointerCapture(t.pointerId)}),this.canvas.addEventListener("pointermove",t=>{if(!this._dragging)return;const s=t.clientX-this._last[0],o=t.clientY-this._last[1];if(this._last=[t.clientX,t.clientY],this._dragButton===0){this.theta-=s*this.rotateSpeed,this.phi-=o*this.rotateSpeed;const n=.001;this.phi=Math.max(n,Math.min(Math.PI-n,this.phi))}else(this._dragButton===1||this._dragButton===2)&&this.pan(-s,o)}),this.canvas.addEventListener("wheel",t=>{t.preventDefault();const s=Math.exp(t.deltaY*this.zoomSpeed);this.radius=Math.min(this.maxRadius,Math.max(this.minRadius,this.radius*s))},{passive:!1})}pan(t,s){const o=Math.sin(this.phi)*Math.sin(this.theta),n=Math.cos(this.phi),i=Math.sin(this.phi)*Math.cos(this.theta),e=[o,n,i],a=[0,1,0];let h=a[1]*e[2]-a[2]*e[1],u=a[2]*e[0]-a[0]*e[2],p=a[0]*e[1]-a[1]*e[0];const r=Math.hypot(h,u,p);r>1e-4&&(h/=r,u/=r,p/=r);let d=e[1]*p-e[2]*u,M=e[2]*h-e[0]*p,f=e[0]*u-e[1]*h;const v=this.panSpeed*this.radius;this.target[0]+=(h*t+d*s)*v,this.target[1]+=(u*t+M*s)*v,this.target[2]+=(p*t+f*s)*v}getViewProj(t){const s=Math.PI/4,o=.1,n=1e3,i=1/Math.tan(s/2),e=new Float32Array([i/t,0,0,0,0,i,0,0,0,0,n/(o-n),-1,0,0,n*o/(o-n),0]),a=Math.sin(this.phi)*Math.sin(this.theta)*this.radius+this.target[0],h=Math.cos(this.phi)*this.radius+this.target[1],u=Math.sin(this.phi)*Math.cos(this.theta)*this.radius+this.target[2],p=[a,h,u],r=this.lookAt(p,this.target,[0,1,0]);return this.multiplyMat4ColumnMajor(r,e)}getMatrices(t){const s=Math.PI/4,o=.1,n=1e3,i=1/Math.tan(s/2),e=new Float32Array([i/t,0,0,0,0,i,0,0,0,0,n/(o-n),-1,0,0,n*o/(o-n),0]),a=Math.sin(this.phi)*Math.sin(this.theta)*this.radius+this.target[0],h=Math.cos(this.phi)*this.radius+this.target[1],u=Math.sin(this.phi)*Math.cos(this.theta)*this.radius+this.target[2],p=[a,h,u],r=this.lookAt(p,this.target,[0,1,0]),d=this.multiplyMat4ColumnMajor(r,e),M=this.invertMat4(r),f=this.invertMat4(e);return{view:r,proj:e,viewProj:d,invView:M,invProj:f,eye:p}}lookAt(t,s,o){const n=this.normalize([t[0]-s[0],t[1]-s[1],t[2]-s[2]]),i=this.normalize(this.cross(o,n)),e=this.cross(n,i);return new Float32Array([i[0],e[0],n[0],0,i[1],e[1],n[1],0,i[2],e[2],n[2],0,-this.dot(i,t),-this.dot(e,t),-this.dot(n,t),1])}normalize(t){const s=Math.hypot(t[0],t[1],t[2]);return s>0?[t[0]/s,t[1]/s,t[2]/s]:[0,0,0]}cross(t,s){return[t[1]*s[2]-t[2]*s[1],t[2]*s[0]-t[0]*s[2],t[0]*s[1]-t[1]*s[0]]}dot(t,s){return t[0]*s[0]+t[1]*s[1]+t[2]*s[2]}multiplyMat4ColumnMajor(t,s){const o=new Float32Array(16);for(let n=0;n<4;n++)for(let i=0;i<4;i++)o[n+i*4]=t[0+i*4]*s[n+0*4]+t[1+i*4]*s[n+1*4]+t[2+i*4]*s[n+2*4]+t[3+i*4]*s[n+3*4];return o}invertMat4(t){const s=new Float32Array(16),o=t[0]*(t[5]*t[10]*t[15]-t[5]*t[11]*t[14]-t[9]*t[6]*t[15]+t[9]*t[7]*t[14]+t[13]*t[6]*t[11]-t[13]*t[7]*t[10])+t[4]*(t[1]*t[11]*t[14]-t[1]*t[10]*t[15]+t[9]*t[2]*t[15]-t[9]*t[3]*t[14]-t[13]*t[2]*t[11]+t[13]*t[3]*t[10])+t[8]*(t[1]*t[6]*t[15]-t[1]*t[7]*t[14]-t[5]*t[2]*t[15]+t[5]*t[3]*t[14]+t[13]*t[2]*t[7]-t[13]*t[3]*t[6])+t[12]*(t[1]*t[7]*t[10]-t[1]*t[6]*t[11]+t[5]*t[2]*t[11]-t[5]*t[3]*t[10]-t[9]*t[2]*t[7]+t[9]*t[3]*t[6]);if(o===0)return t;const n=1/o;return s[0]=(t[5]*t[10]*t[15]-t[5]*t[11]*t[14]-t[9]*t[6]*t[15]+t[9]*t[7]*t[14]+t[13]*t[6]*t[11]-t[13]*t[7]*t[10])*n,s[1]=(t[1]*t[11]*t[14]-t[1]*t[10]*t[15]+t[9]*t[2]*t[15]-t[9]*t[3]*t[14]-t[13]*t[2]*t[11]+t[13]*t[3]*t[10])*n,s[2]=(t[1]*t[6]*t[15]-t[1]*t[7]*t[14]-t[5]*t[2]*t[15]+t[5]*t[3]*t[14]+t[13]*t[2]*t[7]-t[13]*t[3]*t[6])*n,s[3]=(t[1]*t[7]*t[10]-t[1]*t[6]*t[11]+t[5]*t[2]*t[11]-t[5]*t[3]*t[10]-t[9]*t[2]*t[7]+t[9]*t[3]*t[6])*n,s[4]=(t[4]*t[11]*t[14]-t[4]*t[10]*t[15]+t[8]*t[6]*t[15]-t[8]*t[7]*t[14]-t[12]*t[6]*t[11]+t[12]*t[7]*t[10])*n,s[5]=(t[0]*t[10]*t[15]-t[0]*t[11]*t[14]-t[8]*t[2]*t[15]+t[8]*t[3]*t[14]+t[12]*t[2]*t[11]-t[12]*t[3]*t[10])*n,s[6]=(t[0]*t[7]*t[14]-t[0]*t[6]*t[15]+t[4]*t[2]*t[15]-t[4]*t[3]*t[14]-t[12]*t[2]*t[7]+t[12]*t[3]*t[6])*n,s[7]=(t[0]*t[6]*t[11]-t[0]*t[7]*t[10]-t[4]*t[2]*t[11]+t[4]*t[3]*t[10]+t[8]*t[2]*t[7]-t[8]*t[3]*t[6])*n,s[8]=(t[4]*t[9]*t[15]-t[4]*t[11]*t[13]-t[8]*t[5]*t[15]+t[8]*t[7]*t[13]+t[12]*t[5]*t[11]-t[12]*t[7]*t[9])*n,s[9]=(t[0]*t[11]*t[13]-t[0]*t[9]*t[15]+t[8]*t[1]*t[15]-t[8]*t[3]*t[13]-t[12]*t[1]*t[11]+t[12]*t[3]*t[9])*n,s[10]=(t[0]*t[5]*t[15]-t[0]*t[7]*t[13]-t[4]*t[1]*t[15]+t[4]*t[3]*t[13]+t[12]*t[1]*t[7]-t[12]*t[5]*t[3])*n,s[11]=(t[0]*t[7]*t[9]-t[0]*t[5]*t[11]+t[4]*t[1]*t[11]-t[4]*t[3]*t[9]-t[8]*t[1]*t[7]+t[8]*t[5]*t[3])*n,s[12]=(t[4]*t[10]*t[13]-t[4]*t[9]*t[14]+t[8]*t[5]*t[14]-t[8]*t[6]*t[13]-t[12]*t[5]*t[10]+t[12]*t[6]*t[9])*n,s[13]=(t[0]*t[9]*t[14]-t[0]*t[10]*t[13]-t[8]*t[1]*t[14]+t[8]*t[2]*t[13]+t[12]*t[1]*t[10]-t[12]*t[2]*t[9])*n,s[14]=(t[0]*t[6]*t[13]-t[0]*t[5]*t[14]+t[4]*t[1]*t[14]-t[4]*t[2]*t[13]-t[12]*t[1]*t[6]+t[12]*t[2]*t[5])*n,s[15]=(t[0]*t[5]*t[10]-t[0]*t[6]*t[9]-t[4]*t[1]*t[10]+t[4]*t[2]*t[9]+t[8]*t[1]*t[6]-t[8]*t[2]*t[5])*n,s}}export{I as O,w as a,P as b,A as c,_ as d,g};
